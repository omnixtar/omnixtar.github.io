<!DOCTYPE html>
<html>
<head>
    <title>My First Survey</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://unpkg.com/survey-core/survey-core.min.css" type="text/css" rel="stylesheet">
    
    <script type="text/javascript" src="https://unpkg.com/survey-core/survey.core.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/survey-js-ui/survey-js-ui.min.js"></script>
    <script type="text/javascript" src="index.js"></script>
</head>
<body>

    <script src="../js/omni.js" type="text/javascript"></script>
    <!-- script src="../h/Phos/libphos.js" type="module"></script -->
    <script type="text/javascript">

var query = window.location.search.substring(1);
var get_param = parse_query_string(query);
if (typeof get_param.nn==="undefined") get_param.nn = "U_OMNI"
// get_param = { nn: "U_OMNI" } // special user name for Omnihash

console.log("omnistart", typeof omnistart)
console.log("ctx", typeof get_param.ctx)

if (typeof get_param!=="undefined")
if (typeof get_param.ctx!=="undefined")
if (typeof omnistart!=="undefined") 
if (get_param.ctx=="on") omnistart()

var e_touch

function onLongPress(element, callback) {
  let timer;

  element.addEventListener('touchstart', (e) => { 
    e_touch = e
    timer = setTimeout(() => {
      timer = null;
      callback();
    }, 500);
  });

  function cancel() {
    clearTimeout(timer);
  }

  element.addEventListener('touchend', cancel);
  element.addEventListener('touchmove', cancel);
}

// top of stack
var t=function(){return s[s.length-1]} 

// And then:
// onLongPress(element, () => {
onLongPress(document, () => {
  // console.log('Long pressed', element);
  var x,y,e=e_touch
  if(e.type.includes(`touch`)) {
    const { touches, changedTouches } = e.originalEvent ?? e;
    const touch = touches[0] ?? changedTouches[0];
    x = touch.pageX;
    y = touch.pageY;
} else if (e.type.includes(`mouse`)) {
    x = e.clientX;
    y = e.clientY;
}
  var sp0 = prompt("Omni*Shell")
  f(sp0)
  alert("Omni*Web onLongPress "+e_touch.type+" "+x+" "+y+" "+t())
});

a=[]; b=[]; c=[[]]; d=[]; ca=[]; tc=[]; m=0; n=0; nc=""; 
// traverse(document.body, (e) => {console.log(JSON.stringify(ca[ca.length-1]))})

function b64(n){if(n>=0&&n<=9)return n.toString();else if(n>=10&&n<=35)return String.fromCharCode(n+55);else if(n>=36&&n<=61)return String.fromCharCode(n+61)}

function traverse(e, func) { // b=[]; a.push(b); 
    
    // nc+=b64(n); // child indices concatenated as string
    
    m++; var n=0; // child index, local copy must have var
    
    if (m==1) { /*c.push([999]);*/ d=c[c.length-1]; }
    if (m>=2) { /*d.push([777]);*/ d=d[d.length-1]; }
    if (a.length<m) a.push([888]); b=a[m-1]
	  ca.push(d); 
    Array.from(e.children).forEach(child => {
        nc+=b64(n) // not cat n (sibling), should be parent's index
        b.push([m,n++,child.outerHTML.substr(0,child.outerHTML.indexOf('>')+1)])
        d.push(b[b.length-1])
		traverse(child, func) // at end of traverse, if child is not last, next child;
// if child is last, pop function, m--
    }); 
    func(e); m--; // move d
    ca.pop(); d=ca[ca.length-1];
		tc.push(nc)
    nc=nc.substring(0,nc.length-1) // remove last character
    
}


</script>


    <div id="surveyContainer"></div>
</body>
</html>
